global
	chroot {{haproxy_chroot}}
        log stdout format raw local0
	user {{haproxy_user}}
	group {{haproxy_group}}
        maxconn {{haproxy_maxconn}}

defaults
	mode	tcp
        timeout connect {{haproxy_timeout_connect}}
        timeout client  {{haproxy_timeout_client}}
        timeout server  {{haproxy_timeout_server}}

#---------------------------------------------------------------------
# health check
#---------------------------------------------------------------------
listen health_check_http_url
    bind :{{haproxy_health_check_port}}
    mode http
    monitor-uri /healthz

#---------------------------------------------------------------------
# Monitoring Configuration
#---------------------------------------------------------------------
listen  stats
        bind *:{{haproxy_monitoring_config_port}}
        mode            http
        #log             global
        maxconn {{haproxy_monitoring_config_maxconn}}
        timeout client  {{haproxy_monitoring_config_timeout_client}}
        timeout server  {{haproxy_monitoring_config_timeout_server}}
        timeout connect {{haproxy_monitoring_config_timeout_connect}}
        timeout queue   {{haproxy_monitoring_config_timeout_queue}}
        stats enable
        stats hide-version
        stats refresh {{haproxy_monitoring_config_refresh}}
        stats show-node
        stats auth {{haproxy_dashboard_user}}:{{haproxy_dashboard_password}}
        stats uri  {{haproxy_monitoring_config_uri}}
        http-request use-service prometheus-exporter if { path /metrics }